[package]
name = "docling-viz-bridge"
version.workspace = true
edition.workspace = true
license.workspace = true
repository.workspace = true
description = "C FFI bridge for DoclingViz macOS visualization app"
keywords = ["ffi", "visualization", "pdf", "macos"]
categories = ["api-bindings", "visualization"]

[lib]
crate-type = ["cdylib", "staticlib", "rlib"]

[dependencies]
# PDF ML pipeline (requires libtorch or ONNX runtime)
docling-pdf-ml = { path = "../docling-pdf-ml", optional = true }
# PDF rendering (requires pdfium library)
pdfium-render = { version = "0.8", optional = true }
# Core types
docling-core = { path = "../docling-core" }
# Image processing
ndarray = { workspace = true, optional = true }
image = { workspace = true }
imageproc = { workspace = true }
# Font rendering for labels
ab_glyph = "0.2"
# CLI argument parsing
clap = { version = "4.4", features = ["derive"], optional = true }
env_logger = { version = "0.10", optional = true }
# Serialization
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
# Timestamps for corrections
chrono = { version = "0.4", features = ["serde"], optional = true }
# Utilities
log = "0.4"
thiserror = "1.0"
once_cell = "1.19"
libc = "0.2"

[features]
default = []
# Basic PDF rendering only (no ML)
pdf-render = ["pdfium-render"]
# Full PDF ML pipeline (requires model files and ML runtime)
pdf-ml = ["pdf-render", "docling-pdf-ml", "ndarray"]
# CLI tools
cli = ["clap", "env_logger", "chrono"]

[[bin]]
name = "dlviz-screenshot"
path = "src/bin/dlviz_screenshot.rs"
required-features = ["cli", "pdf-ml"]

[[bin]]
name = "dlviz-apply-corrections"
path = "src/bin/dlviz_apply_corrections.rs"
required-features = ["cli"]

[[bin]]
name = "dlviz-crop"
path = "src/bin/dlviz_crop.rs"
required-features = ["cli"]

[[bin]]
name = "dlviz-table"
path = "src/bin/dlviz_table.rs"
required-features = ["cli", "pdf-ml"]

[[bin]]
name = "dlviz-batch-review"
path = "src/bin/dlviz_batch_review.rs"
required-features = ["cli", "pdf-ml"]

[[bin]]
name = "dlviz-diff"
path = "src/bin/dlviz_diff.rs"
required-features = ["cli", "pdf-ml"]

[[bin]]
name = "dlviz-metrics"
path = "src/bin/dlviz_metrics.rs"
required-features = ["cli"]

[build-dependencies]
cbindgen = "0.26"

[dev-dependencies]
tempfile = "3.10"
base64 = "0.22"
reqwest = { version = "0.11", features = ["blocking", "json"] }
