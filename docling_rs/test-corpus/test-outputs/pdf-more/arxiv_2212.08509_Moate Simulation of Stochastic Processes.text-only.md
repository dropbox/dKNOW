## Moate Simulation of Stochastic Processes

Michael E. Mura âˆ—

31 October, 2022

## Abstract

A novel approach called Moate Simulation is presented to provide an accurate numerical evolution of probability distribution functions represented on grids arising from stochastic differential processes where initial conditions are specified. Where the variables of stochastic differential equations may be transformed via ItË† o-Doeblin calculus into stochastic differentials with a constant diffusion term, the probability distribution function for these variables can be simulated in discrete time steps. The drift is applied directly to a volume element of the distribution while the stochastic diffusion term is applied through the use of convolution techniques such as Fast or Discrete Fourier Transforms. This allows for highly accurate distributions to be efficiently simulated to a given time horizon and may be employed in one, two or higher dimensional expectation integrals, e.g. for pricing of financial derivatives. The Moate Simulation approach forms a more accurate and considerably faster alternative to Monte Carlo Simulation for many applications while retaining the opportunity to alter the distribution in mid-simulation.

Keywords:

Stochastic Processes, Moate Simulation, Convolution, Financial Derivatives Pricing

MSC-class:

65C30 (Primary), 60G99, 91G60 (Secondary)

ACM-class: G.3; I.6.8

JEL-class: C15, C63, G12, G13, G17

In this paper we consider an alternative numerical approach to approximating the evolving probability density distribution for a process described by a generalised ItË† o process. This approach is called Moate Simulation to distinguish it from other approaches like Monte Carlo Simulation, Multinomial Trees and the like.

Stochastic processes have been employed in a wide number of models and applications in finance, science and engineering. Simply put, a stochastic process describes the indexed evolution of a random phenomenon, where in this note the index is taken to be time. The phenomenon is described as a set of random variables at each time index. The process is often described with a set of 'spatial' dimensions ğ‘‹ and a time dimension ğ‘¡ . The time index can either be discrete or continuous. The set of random variables { ğ‘‹ ğ‘¡ } may also be discrete or continuous. Different cases of model can be classified:

- (A) space is discrete and time is discrete;
- (B) space is discrete and time is continuous;
- (C) space is continuous and time is discrete;
- (D) space is continuous and time is also continuous.

A realisation of a random variable over time forms a path. The density of all possible paths forms an evolution of distribution of the random variables that evolves from one instant to the next, describing an evolution of probability density function over time. The initial distribution of the spatial location needs to be specified and in many cases it is known to be at a discrete point or may given by a starting distribution. The probability distribution at a given future time is often the desired outcome for many applications, while for other applications the path dependency may be important too.

This paper is summarised as follows. The first section considers the generalised ItË† o process in finance and discusses the path-distribution duality in existing numerical approaches. The next section considers a number of different ways a single discrete stochastic time step can be modelled probabilistically, and is followed by a section which discusses a set of transformations that can be applied to a probability distribution during a single step. The details of the Moate Simulation approach are then presented in terms of these transformations. A

Formal presentations of probability theory related to random processes can be found in many fine sources including Doob [1], Grimmett and Stirzaker [2], and Shreve [3] and so such details are not included here. The Moate Simulation of probability density for a set of stochastic processes is general and is applicable in many domains but, in this note, we focus on some of its financial applications.

âˆ— Storhaven Financial Services, United Kingdom

subsequent section describes the numerical approach to the Moate Simulation and compares an example wellknown vanilla option analytic results from the Black-Scholes-Merton formulae[4, 5] with those results generated by corresponding Moate and Monte Carlo simulations. Finally, some extensions that are of particular interest in finance are presented for Moate Simulation, including higher dimensional modelling.

## 1 Stochastic Processes for Finance

A wide variety of stochastic processes are employed in financial modelling, for example, to describe asset prices, interest rates, volatility or forecasts of economic variables. When considering an appropriate model for a process, continuity or discreteness of the spatial and temporal representation needs to be established. Processes can often start out with discrete descriptions of the variables to help elucidate the properties of the system and are later remodelled to be continuous, or vice-versa.

For example, in a financial setting, end-of-day prices ğ‘ƒ are discrete in both space (i.e. price) and time (case (A)). If prices were purely deterministic then one might choose to represent changes in the prices with âˆ† ğ‘ƒ ğ‘¡ as

<!-- formula-not-decoded -->

where ğœ‡ ( ğ‘ƒ ğ‘¡ , ğ‘¡ ) is some function of space and time. The usual notation of calculus is employed here to represent a discrete change in ğ‘ as âˆ† ğ‘ and continuous change in ğ‘ to be represented as an infinitesimal change ğ‘‘ğ‘ . Also, the index ğ‘¡ is represented as a subscript to the spatial variable, here ğ‘ƒ ğ‘¡ .

Discrete prices, despite representing reality, are rarely modelled as such so the spatial dimension is often approximated to be continuous, case (C) in the above classification. The same equation (1) can be used for continuous prices with a discrete time step. The case (D) is often used when prices need to be modelled intra-day where the continuous time is convenient when modelling. The notation for this is the familiar expression for a deterministic continuous (space and time) process

<!-- formula-not-decoded -->

Deterministic processes in finance are not as common as stochastic (ergo non-deterministic) processes. The generalised ItË† o process [6] is given by

<!-- formula-not-decoded -->

where the terms ğ‘ and ğ‘ are both functions of the stochastic variable ğ‘ƒ ğ‘¡ at time ğ‘¡ and time ğ‘¡ itself. Bachelier [7] produced one of the earliest examples of continuous time analysis, introducing the idea that stocks had a random nature that could be modelled with Brownian Motions. Samuelson [8] introduced the stochastic differential equation for log-normal processes in the form familiar to practitioners of financial economics

<!-- formula-not-decoded -->

This stochastic differential equation is an axiom of the Black-Scholes-Merton model[4, 5]. The Samuelson stochastic differential equation 4 contains two constants, ğœ‡ and ğœ and two differentials terms, ğ‘‘ğ‘¡ and the Wiener increment ğ‘‘ğ‘Š ğ‘¡ , thus ğ‘‘ğ‘ƒ ğ‘¡ is an ItË† o process. The first term in the equation represents a (deterministic) drift term and the second term a stochastic diffusion term. The Wiener increment ğ‘‘ğ‘Š ğ‘¡ can be considered to be a Gaussian function with infinitesimal width, in effect a normal distribution ğ’© (0 , ğ‘‘ğ‘¡ ) with a variance of ğ‘‘ğ‘¡ . This decomposition of the ItË† o process into a deterministic drift term and a stochastic diffusion term has influenced the way that financial practitioners think about price moves in financial instruments. The Samuelson stochastic differential equation 4 has formed a standard model for equity processes, while a large variety of other ItË† o processes exist for interest rates (Vasicek, Ornstein-Uhlenbeck, et al.) and stochastic volatility (for examples see Brigo and Mercurio [9]).

The evolving probability distribution view is more natural where a partial differential equation (PDE) can be derived from the stochastic differential equation. Using suitable boundary conditions, analytic or numerical solutions of the PDE may sometimes be obtained which determine the probability distribution of the stochastic

A kind of duality exists in the description of the evolution of stochastic variables; they may be considered as paths, or as probability distributions which evolve over time. For financial practitioners it is very natural to think of the price processes in terms of paths because historical prices are typically presented as time series. This means that the Monte Carlo approach introduced to finance by Boyle [10] is so intuitive that stochastic processes are very often and predominately imagined as a set of Monte Carlo paths for modelling purposes. Binomial (or multinomial) trees are another useful alternative for modelling stochastic processes (see Shreve [11]) where each set of the stochastic variables at a time ğ‘¡ are given as a discrete set of spatial values with associated probabilities. The tree approaches identify a set of specific paths and then determine the probability of being at any node on the tree at any given time.

Figure 1: The sub-figures show examples of discrete (a-d), Monte Carlo (e-f) and continuous (g-i) outcomes for one period between ğ‘¡ 0 and ğ‘¡ 1 for a starting quantity ğ‘‹ . The discrete probabilities ğ‘ ğ‘– must sum to 1 for (a-f) and are expected to be greater than 0, while the continuous probability distribution functions integrate to unity. For the discrete cases the changes in ğ‘‹ , denoted âˆ† ğ‘‹ ğ‘– are distinct and finite. As the Monte Carlo values are drawn from iid (independent, identically distributed) distributions each outcome is considered to be have the same probability ğ‘ = 1 /ğ‘› .

<!-- image -->

variable either explicitly or implicitly. In general, analytic solutions may be difficult to obtain, and the numerical solutions can be computationally expensive where they are tractable.

In many cases the goal of the modelling is to obtain the probability distribution of the stochastic variable at a particular time and employ it in an expectation integral. The different modelling approaches to stochastic processes have their own strengths and weaknesses, typically in accuracy, flexibility, expense of computation or accepted model risk.

With respect to the path-distribution duality, the Moate Simulation approach is closest to the probability distribution view. The approach is to start with a known value or distribution describing the stochastic variable and evolve the distribution with discrete time steps according to the dynamics of the given stochastic differential equation; the discrete time aspect is similar to Monte Carlo or Tree approaches. With Moate Simulation the distribution is altered between two adjacent time steps by moving the distribution with the drift term and then applying diffusion to drifted distribution (or alternatively diffusing first then drifting). The probability distribution is represented as a function on a set of grid points and the accuracy depends on the fineness of the grid used.

Next a number of different ways in which a single step is simulated is presented as found in some of the models already discussed.

## 2 Modelling a Single Time Step

A variety of ways to represent a single time step in a continuous space, discrete time process, case (C) are presented in figure 1. Each sub-figure shows a different modelling approach to a time step between time ğ‘¡ 0 and time ğ‘¡ 1 . At ğ‘¡ 1 the values of the stochastic variable ğ‘‹ are shown along with their associated probabilities (discrete) or probability distributions (continuous).

Next we consider Monte Carlo approaches as introduced to finance by Boyle [10]. Figure 1(e) shows 10 different draws from an i.i.d. distribution, each representing a single step between ğ‘¡ 0 and time ğ‘¡ 1 . It is more usual to see a Monte Carlo simulation as a set of consecutive steps forming a path between two points in time and space formed by random spatial moves on a regular time grid, with this evolution being performed many times to create a set of paths. Here we focus on a single step so that each draw creates its own spatial move over the same single time step. Although each step is discrete, as the set of ğ‘› spatial moves increases the histogram of positions increasingly tends to resemble the distribution from which the random moves were drawn. Figure 1(f) shows 50 such single steps. The probability attributed to each move is typically treated as the reciprocal of the number of draws, ğ‘› , and where the process is i.i.d. the increments may be weakly or strongly stationary.

Figure 1(a) represents the simplest representation where a change occurs between the two times that is completely determined with probability ğ‘ = 1 . This is the first in the family sequence of models which includes the binomial, fig 1(b), and trinomial, fig 1(c), models, where a probability is assigned to each of the two or three respective outcomes, but since the change shown in 1(a) is a single outcome the result is certain. In this sense, a deterministic change is a special edge case of the multinomial description in 1(d). The use of the binomial models in derivative pricing is discussed extensively by Shreve [11], where single steps are combined into trees to describe the stochastic processes.

Finally we consider the continuous distribution generated during a single step. In the limit, it is possible to describe the outcome of a single time step as being represented by at least a piecewise continuous probability distribution function. Figure 1(g) represents a uniform probability distribution between a pair of spatial limits sometimes denoted as Î ( ğ‘‹ ) , figure 1(h) represents a triangular probability distribution function sometimes denoted by Î›( ğ‘‹ ) , while figure 1(i) represents a continuous normal probability distribution function sometimes represented as ğ’© ( ğœ‡, ğœ 2 ) where ğœ‡ is the mean and ğœ 2 is the variance. There is a deep connection between these three distributions. The triangular function is formed by adding two random variables drawn from the uniform distribution (think of the outcome of rolling two dice). In the limit, the addition of many random variables tends towards a normal probability distribution as outlined by the Central Limit Theorem. See section 3.6 of Osgood [12] for a more detailed discussion.

The continuous normal probability distribution function in figure 1(i) is a discrete time representation of a Wiener increment âˆ† ğ‘Š . This invites the a single step in the generalised ItË† o process in equation 3 to be seen as a drift from an origination point coupled with a diffusion yielding a distribution at the end of the time step. This distributional view complements the Monte Carlo style path view, and it is this distributional approach that is employed in Moate Simulation.

In the class of continuous distributions, the discrete deterministic single step of figure 1(a) can be considered to be a Dirac delta function, ğ›¿ , a continuous distribution function with infinitesimal width.

## 3 Transforming Distributions

A stochastic increment over a time âˆ† ğ‘¡ can be characterised by one or more transformations ğ‘ that turn a distribution ğ‘“ ğ‘¡ ( ğ‘‹ ) at ğ‘¡ into a different distribution ğ‘“ ğ‘¡ +Î” ğ‘¡ ( ğ‘‹ ) at ğ‘¡ + âˆ† ğ‘¡ , in either the discrete or continuous context

<!-- formula-not-decoded -->

The distribution is equivalently described by either its probability density function (PDF) or the cumulative distribution function (CDF). We will use ğ‘“ ğ‘¡ ( ğ‘‹ ) denote the CDF with the corresponding PDF is its derivative denoted here as ğ¹ ğ‘¡ ( ğ‘‹ ) = ğ‘‘ğ‘“ ğ‘¡ ( ğ‘‹ ) ğ‘‘ğ‘‹ .

There are four types of transformation of interest in this paper.

Some additional notation concerning the representation of the distribution functions on a grid is introduced here. The function ğ‘“ ğ‘¡ ( ğ‘‹ ) is the distribution at time ğ‘¡ is defined on a domain of ğ‘‹ . A grid representation of ğ‘“ ğ‘¡ ( ğ‘‹ ) is defined on a set of ğ‘› values of ğ‘‹ giving rise to a set of ğ‘› tuples of position ğ‘‹ ğ‘– and the value ğ‘“ ( ğ‘¡ ) ğ‘– â‰¡ ğ‘“ ( ğ‘‹ ğ‘– , ğ‘¡ ) , that is ( ğ‘‹ ( ğ‘¡ ) ğ‘– , ğ‘“ ( ğ‘¡ ) ğ‘– ) âˆ€ ğ‘– âˆˆ ğ‘› . The superscript ğ‘¡ for ğ‘‹ is necessary because the grid may change from one time step to another.

- change of variable : ( ğ‘‹ ( ğ‘¡ ) ğ‘– , ğ‘“ ( ğ‘¡ ) ğ‘– ) change of variable -- - - - - - - - - - - - â†’ ( ğ‘Œ ( ğ‘¡ ) ğ‘– , ğ‘“ ( ğ‘¡ ) ğ‘– ) ;
- interpolation : { ( ğ‘‹ ( ğ‘¡ ) ğ‘– , ğ‘“ ( ğ‘¡ ) ğ‘– ) } interpolation -- - - - - - - - â†’ { ( ğ‘‹ ( ğ‘¡ ) ğ‘— , ğ‘“ ( ğ‘¡ ) ğ‘— } ) ;

- deterministic transformation : ( ğ‘‹ ( ğ‘¡ ) ğ‘– , ğ‘“ ( ğ‘¡ ) ğ‘– ) drift - - - â†’ ( ğ‘‹ ( ğ‘¡ ) ğ‘– + ğ‘ ( ğ‘‹ ( ğ‘¡ ) ğ‘– , ğ‘¡ )âˆ† ğ‘¡, ğ‘“ ( ğ‘¡ ) ğ‘– ) ;
- diffusion transformation : { ( ğ‘‹ ( ğ‘¡ ) ğ‘– , ğ‘“ ( ğ‘¡ ) ğ‘– ) } diffuse - - - - â†’ { ( ğ‘‹ ( ğ‘¡ +1) ğ‘– , ğ‘“ ( ğ‘¡ +1) ğ‘– ) } .

We consider each transformation in turn.

## 3.1 Change of Variable

Consider the change of variable from ğ‘‹ to ğ‘Œ for the function ğ‘Œ ( ğ‘‹ ) with a Jacobian ğ‘‘ğ‘‹ ğ‘‘ğ‘Œ

<!-- formula-not-decoded -->

The value of cumulative distribution remains unchanged with the change in variable so converting to the PDF takes account of the Jacobian implicitly.

## 3.2 Interpolation

Interpolation is a transformation intended to leave the underlying function unaltered as the grid point representation is changed from one set of points, ğ‘– âˆˆ ğ‘› , to another, ğ‘— âˆˆ ğ‘š . In many respects interpolation is like an identity but it can have consequences that impact the numerical accuracy.

## 3.3 Deterministic Transformation

The deterministic transformation moves the mass of the distribution from one point ğ‘‹ ğ‘– to a different single point. Where the drift is a constant, for example ğœ‡ âˆ† ğ‘¡ , then the probability mass associated with ğ‘‹ ğ‘– moves to ğ‘‹ ğ‘– + ğœ‡ âˆ† ğ‘¡ , effecting a simple translation of the cumulative distribution function ğ‘“ . Where the drift is a function of time or position, for example ğœ‡ğ‘‹ 2 âˆ† ğ‘¡ , then the probability mass moves from ğ‘‹ ğ‘– to ğ‘‹ ğ‘– + ğœ‡ğ‘‹ 2 ğ‘– âˆ† ğ‘¡ ; in this instance the CDF does not move uniformly but is stretched differently depending on the value of ğ‘‹ ğ‘– . If the general drift coefficient is ğ‘ ( ğ‘‹,ğ‘¡ ) over a time step âˆ† ğ‘¡ then we defined the operator âŠ• to take a distribution ğ‘“ and drift of stretch the probability mass by ğ‘ ( ğ‘‹,ğ‘¡ )âˆ† ğ‘¡ which is written as ğ‘“ ( ğ‘¡ ) âŠ• ğ‘ ( ğ‘‹,ğ‘¡ )âˆ† ğ‘¡ ; this operator was selected by analogy to the + addition operator in ğ‘‹ ( ğ‘¡ +Î” ğ‘¡ ) = ğ‘‹ ( ğ‘¡ ) + ğ‘ ( ğ‘‹,ğ‘¡ )âˆ† ğ‘¡ .

## 3.4 Diffusion Transformation

The diffusion transformation above redistributes all the probability mass from each location according to some stochastic function with an associated distribution. For a Wiener process the stochastic term is normal.

At every moment each piece of probability mass in each contiguous locus is diffusing (and in the general case it may be drifting too). This redistribution transformation is achieved through the convolution of the starting distribution with the diffusive distribution (for example, a normal distribution to represent a Wiener process over discrete time step), yielding the new distribution at after the step time âˆ† ğ‘¡ .

To visualise this, consider the following analogy. The waves from the sea propagate forward until the come on some closely spaced posts (about a wavelength in spacing). Each wave passes through and diffracts, that is it spreads out from each gap it just passed came through in roughly semi-circular form. The semi-circular wavefronts recombine so that at some distance from the posts the wave appears linear again. The analogy is that, at the gap (the locus), the water in the wave (initial distribution) coming though diffracts (diffuses) in semi-circles (normal distributions) and the new wave front (final distribution).

It is useful to recall some of the properties of the convolution operator. The convolution of two distributions ğ‘“ ( ğ‘‹ ) and ğ‘” ( ğ‘‹ ) is denoted by * , is a commutative operation and is defined as

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

The addition of two independent random variables produces a distribution that is formed by convolution. If Î ( ğ‘‹ ) represents a uniform distribution function and then convolution between two Î ( ğ‘‹ ) functions yields a triangular function Î›( ğ‘‹ )

<!-- formula-not-decoded -->

The convolution of a discrete distribution characterised as a Dirac delta function ğ›¿ 0 ( ğ‘‹ ) with a distribution ğ‘“ ( ğ‘‹ ) yields the same function ğ‘“ ( ğ‘‹ )

<!-- formula-not-decoded -->

If the delta function is centred at a location ğ‘ then the effect of convolution is to translate the distribution ğ‘“ ( ğ‘‹ )

<!-- formula-not-decoded -->

There also exists the concept of a convolution power defined as

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

and

Given that appropriate conditions are met, the Central Limit Theorem says that a distribution function ğ‘“ ( ğ‘‹ ) with a mean of zero and a variance of ğœ 2 then lim ğ‘¥ â†’âˆ ğ‘¥ * ğ‘› /ğœ âˆš ğ‘› tends weakly towards the standard normal distribution. Convolution of one distribution function with another can be considered as equivalent to diffusion.

Figure 2: Visualisation of a drift-first process increment. Starting with a Normal CDF ğ’© (0 , 3) (the solid black line) and having a drift increment of ğ‘ ( ğ‘‹,ğ‘¡ ) = 2 ğ‘‹ and âˆ† ğ‘¡ = 1 , the drifted distribution becomes ğ’© (0 , 9) (the dotted black line). Subsequently the diffusion operation is applied to mass at each point of the drifted distribution, represented by the small grey bell shaped functions, and masses are redistributed around the locus of the point of the mass by a convolution operation according to the form of the stochastic increment. Here the orange line is the dotted line convolved with a Normal Distribution ğ’© (0 , 3) , and represents the result of the drift-first process increment on the original distribution.

<!-- image -->

## 3.5 A Visualisation of Deterministic and Diffusion Transformations

The figure 2 shows a cumulative distribution function undergoing a deterministic transformation, being stretched by an increment of ğ‘ ( ğ‘‹,ğ‘¡ )âˆ† ğ‘¡ = 2 ğ‘‹ ğ‘– âˆ† ğ‘¡ , followed by a diffusion transformation. The combination of the drift (deterministic) and diffusion transformations is a single step in a standard Moate Simulation. The example purposely introduces a drift term which is spatially dependent rather than a simple constant drift. This drift is also large to enable the drifted loci to be easily seen and annotated. The widths of the overlying grey Gaussian diffusion functions shown are illustrative and not accurate. It is clear from the diagram that the diffusion applied to the dotted line results in a wider CDF, as shown with the orange line.

## 4 Moate Simulation

We have just introduced the important transformations that allow us to cast a generalised ItË† o process which is continuous in time and space

<!-- formula-not-decoded -->

into its discrete time/continuous space equivalent

<!-- formula-not-decoded -->

and this represents a single step in a multi-step Moate Simulation.

This allows us to consider the generalised ItË† o process as a transformation that changes one distribution ğ‘“ ( ğ‘¡ ) ( ğ‘‹ ) â‰¡ ğ‘“ ( ğ‘‹,ğ‘¡ ) into another ğ‘“ ( ğ‘¡ +Î” ğ‘¡ ) â‰¡ ğ‘“ ( ğ‘‹,ğ‘¡ + âˆ† ğ‘¡ ) through a drift with coefficient ğ‘ ğ‘¡ â‰¡ ğ‘ ( ğ‘‹,ğ‘¡ ) and a diffusion with coefficient ğ‘ ğ‘¡ â‰¡ ğ‘ ( ğ‘‹,ğ‘¡ ) that multiplies the normal distribution with variance âˆ† ğ‘¡ given as âˆ† ğ‘Š = ğ’© (0 , âˆ† ğ‘¡ ) â‰¡ ğ’© ; the discrete time equivalent can be written as a drift-first approximation

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

The two approximations are not identical in the general case but where the drift ğ‘ ğ‘¡ is independent of location ğ‘‹ the two operations yield the same outcome.

Consider a multi step Moate Simulation, starting with a distribution ğ‘“ (0) . The parenthesised superscript on ğ‘“ indicates the number of âˆ† ğ‘¡ sized steps taken. The drift-first step at ğ‘¡ 0 +âˆ† ğ‘¡ yields ğ‘“ (1) as

<!-- formula-not-decoded -->

and after the second step ğ‘“ (2) is given by

<!-- formula-not-decoded -->

so that the process is described as a set of nested operations with the recursion relationship

<!-- formula-not-decoded -->

Likewise, the diffusion-first recursion relationship is

<!-- formula-not-decoded -->

It is possible in some special cases to obtain an analytic expression for ğ‘“ ( ğ‘› ) . This is possible where the process is purely deterministic, or where the drift ğ‘ ğ‘¡ and diffusion ğ‘ ğ‘¡ coefficients are constants. In the latter case, the result is

<!-- formula-not-decoded -->

However, for more general forms of ğ‘ and ğ‘ which may depend on both time ğ‘¡ and location ğ‘‹ , analytic results may not easily present themselves. Fortunately, the numerical approach to Moate Simulation outlined in the next section can be tractable, accurate and an efficient way to obtain the terminal or intermediate distributions, allowing for it to be utilised in many practical ways.

## 5 A Numerical Approach to Moate Simulation

Recalling the single step of a discrete time generalised ItË† o process as found in equation 16, if the diffusion coefficient is not a constant then the rate of diffusion from each locus of the probability distribution will be different and this presents an 'apparent' impediment to the direct use of convolution in Moate Simulation. The remedy for this is to simulate a different stochastic variable which is derived from the stochastic differential equation of the original stochastic variable but has a constant diffusion term for all loci, and at the end of the simulation transform back to the original stochastic variable.

or a diffusion-first approximation.

## 5.1 Variable Change to Constant Diffusion

The first step is to change the variable using ItË† o-Doeblin formula so that the diffusion coefficient in the transformed variable is a constant, if this is not already the case. The drift coefficient will change too and may not be a constant but this is not in itself an impediment to obtaining a numerical result.

For example, the classic case is the Samuelson process

<!-- formula-not-decoded -->

where the price ğ‘† ğ‘¡ is transformed to ğ¿ ğ‘¡ where ğ¿ ğ‘¡ = log ğ‘† ğ‘¡ .

<!-- formula-not-decoded -->

The change of stochastic variable from ğ‘† ğ‘¡ to ğ¿ ğ‘¡ has produced an expression in equation 26 where the coefficient of the Wiener increment is the constant ğœ . The Moate Simulation can be used here with ğ¿ 0 = log ğ‘† 0 is the point at time ğ‘¡ = 0 where the initial distribution is known. If we assume that the initial PDF is represented by a Dirac ğ›¿ function, or equivalently the initial CDF is represented by a unit step (Heaviside) function, then distribution after the first discrete step âˆ† ğ‘¡ is given by

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

This case is straightforward and, as discussed above, gives an analytic distribution at some final time ğ‘‡ of

<!-- formula-not-decoded -->

so a numerical approach is not necessary here.

Consider a different case where even after transformation the diffusion coefficient is constant in time and space but drift term is not. The process below contains a drift term in the square of ğ‘† ğ‘¡ .

<!-- formula-not-decoded -->

Applying ItË† o's lemma to this equation, with ğ¿ ğ‘¡ = log ğ‘† ğ‘¡ as before, results in

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

Another case might be to have no ğ‘† ğ‘¡ in the drift coefficient so that

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

so that

A third case involves the transformation of variable ğ‘€ ğ‘¡ = ğ‘† 2 ğ‘¡ in the equation

<!-- formula-not-decoded -->

so that after application of ItË† o's lemma

<!-- formula-not-decoded -->

None of these latter three stochastic differential equations are proposed for any particular physical or financial purpose; they merely demonstrate that a change of stochastic variable can lead to the coefficient of the Wiener increment being a constant. Note in the third case the transformed drift coefficient will be undefined when

ğ‘€ ğ‘¡ = 0 so the domain of the stochastic variable should be carefully considered. In this case the original stochastic differential would be have been undefined at ğ‘† ğ‘¡ = 0 too so any modelling difficulties arising from this should have been recognised at this earlier stage.

Given the spatially constant form of the diffusion coefficient the evolution of the probability distribution can be attempted numerically, assuming that the continuous stochastic differential equation can be approximated in discrete time and that the distribution can be adequately represented on a grid.

In the case where we start with a discrete problem, we can approximate it as being continuous, transform the variable with ItË† o's lemma to the required form, and then re-discretise the transformed stochastic differential equation.

## 5.2 Simulation

Suppose that we have transformed to a random variable ğ‘‹ that gives us a drift-first approximation, with a constant drift term ğ‘ = ğ‘ ( ğ‘‹,ğ‘¡ ) then the distribution ğ‘“ will evolve as

<!-- formula-not-decoded -->

The distribution in the initial state is known at a given time ğ‘¡ 0 , and is denoted as ğ‘“ ( ğ‘‹,ğ‘¡ 0 ) . We can choose to work with ğ‘“ ( ğ‘‹,ğ‘¡ ) , the cumulative distribution function (CDF), or ğ¹ ( ğ‘‹,ğ‘¡ 0 ) , its equivalent probability density function (PDF), although there are pros and cons numerically with either functional form.

It is also possible to start with a known distribution at ğ‘¡ 0 and represent it directly onto a discrete grid. Since we want to apply drift to the distribution and then convolve it with ğ‘ ğ’© (0 , âˆ† ğ‘¡ ) (or vice-versa) we need a grid representation which will represent the distribution at ğ‘¡ , the diffusion function ğ‘ ğ’© (0 , âˆ† ğ‘¡ ) , and the next distribution at ğ‘¡ +âˆ† ğ‘¡ sufficiently accurately. The extent of the grid should be selected so that the value of the probability density function is negligible outside the grid. Many convolution algorithms using Discrete Fourier Transformations (DFT) require a uniformly spaced grid although Non-Uniform Discrete Fourier Transform (NUDFT) approaches also exist. The use of Fourier Transform techniques, particularly the Discrete (or Fast) Fourier Transforms (DFT/FFT), are both highly efficient and readily available in many mathematical libraries, and these algorithms can use specialised hardware like vector, tensor or GPU processors for to greatly speed up computation.

Where the location at ğ‘¡ 0 is at a single discrete point the PDF can be represented as a Dirac delta function ğ›¿ ( ğ‘‹ 0 ) or its cumulative equivalent, and Heaviside function ğ» ( ğ‘‹ 0 ) . The first step in a drift-first simulation will shift the delta function to ğ›¿ ( ğ‘‹ 0 + ğ‘ ( ğ‘‹,ğ‘¡ 0 )) and the diffusion step is applied to this so that the distribution at ğ‘¡ 0 +âˆ† ğ‘¡ is given by ğ’© ( ğ‘‹ 0 + ğ‘ ( ğ‘‹,ğ‘¡ 0 )âˆ† ğ‘¡, ğ‘ 2 âˆ† ğ‘¡ ) and so the first function we need to represent on the grid is the distribution after the first step. This distribution function can be represented on a discrete grid.

We consider a function at time ğ‘¡ on a grid as a set of ğ‘› tuples of position ğ‘‹ ğ‘– and the value ğ‘“ ğ‘– â‰¡ ğ‘“ ( ğ‘‹ ğ‘– , ğ‘¡ ) , that is ( ğ‘‹ ( ğ‘¡ ) ğ‘– , ğ‘“ ( ğ‘¡ ) ğ‘– ) âˆ€ ğ‘– âˆˆ ğ‘› . Drifting the function does not change the value of ğ‘“ ( ğ‘¡ ) ğ‘– in the tuple but it does change the location ğ‘‹ ( ğ‘¡ ) ğ‘– , so that ğ‘‹ ( ğ‘¡ ) ğ‘– is replaced with ğ‘‹ ( ğ‘¡ ) ğ‘– + ğ‘ ( ğ‘‹ ( ğ‘¡ ) ğ‘– , ğ‘¡ )âˆ† ğ‘¡ . The drifting, in effect, creates a distortion of the location element of the tuple. Since for the convolution operation a uniform grid is required, the set of ğ‘› tuples needs to be interpolated on to a suitable uniform grid (here ğ‘š tuples indexed by ğ‘— ). The interpolation function selected should depend on the functional form of the distribution but it may be convenient to use Piecewise Cubic Hermite Interpolating Polynomial (PCHIP) interpolation or cubic spline interpolation.

So the drift step is followed by interpolation onto a new uniform grid, and then the convolution operation is applied with the diffusion function ğ‘ ğ’© (0 , âˆ† ğ‘¡ ) . The drift-first simulation step is summarised as the sequence of operations

<!-- formula-not-decoded -->

The equivalent diffusion-first operation sequence is

<!-- formula-not-decoded -->

We should expect that as the time step âˆ† ğ‘¡ is reduced towards zero the distribution produced by drift-first and diffusion-first respective simulations converge. The degree to which these distributions differ can be used to create measure of numerical error arising from the choice of drift or diffusion first sequence.

There are a number of technical details associated with the convolution step that may merit a mention. Firstly, DFT algorithms for convolution often require padding and for a PDF this is normally with zeros, while for a CDF it should be left padded with zeros and right padded with ones. This means that for the PDF a renormalisation step may be useful if the numerical integration of the PDF does not yield hard unity; without this renormalisation multiple simulation steps may introduce a systematic bias which affects the accuracy of integrals involving the PDF. The use of the CDF during the simulation ensures that the integration of its

corresponding PDF will be unity by construction, but particular care needs to be taken to prevent distortion at the right edge of the distribution as some algorithms will attempt to pad on the right with zeros that can cause the right tail of the CDF to dip away from unity.

As diffusion occurs on each step of the simulation it may also be necessary to increase the extent and/or the spacing of the grid. Extending the grid occurs naturally by selecting a constant threshold for the tails of the CDF up to which the grid extends from the centre in both directions.

Additionally, Fourier Transform based convolution algorithms may benefit from the recognition that the diffusion function, here ğ‘ ğ’© (0 , âˆ† ğ‘¡ ) , is identical on each step of the simulation so some numerical speed-up may be achieved by only having to transform the distribution function ğ‘“ on each step and convolve this with a retained transformed diffusion function (assuming the grid spacing is not altered between simulation steps).

## 5.3 Example: Vanilla Option Pricing using Moate Simulation

We could, in principle, select any general ItË† o process to demonstrate Moate Simulation but the choice of the Black-Scholes model allows for the comparison of the accuracy of the numerical results with analytic results. The Black-Scholes European call and put option pricing formulae for equities are based on the Samuelson process (equation 25) and these analytic formulae can be used to compare the option prices with those determined using Moate Simulation using the log process in equation 26.

<!-- formula-not-decoded -->

The Black-Scholes European call option (no dividend) has a closed form analytic solution for its value ğ¶ ğ‘¡ given by while the corresponding European put option value, ğ‘ƒ ğ‘¡ , is given by

<!-- formula-not-decoded -->

where ğ‘† ğ‘¡ is the current spot price, ğ¾ is the strike price, ğ‘Ÿ is the risk-free rate, ğœ is the volatility, ğœ is the time until the option expiry, and Î¦( Â· ) is the standard normal cumulative distribution function.

Table 1: Moate Simulation results for Black-Scholes call and put option for daily (365 iterations) grid evolution. The vanilla European options have a strike of ğ¾ = 4 . 30 , expiration ğœ = 1 , risk-free rate ğ‘Ÿ = 0 . 05 , volatility ğœ = 0 . 1 and the current spot price ğ‘† ğ‘¡ = 4 . 00 . The precision shown is to the first differing digit from the analytic value, and the relative difference is the absolute difference to the analytic value. Probability distributions are retained to a CDF threshold of 1e-12. A Monte Carlo calculation using 25 million paths and antithetic sampling provides a comparator to the Moate Simulation results. The run-times shown for each calculation using an AMD Phenom II X6 1075T 3.00 GHz Processor (2010) are for very rough comparison only and negligible optimisation of the code was attempted for the simulations.

| Log Spacing      |   Call Price | Abs diff   |   Put Price | Abs diff   | Run-time (sec)   |
|------------------|--------------|------------|-------------|------------|------------------|
| Analytic         |     0.120166 | -          |    0.210452 | -          | âˆ¼ 2e-3           |
| 1E-05            |     0.120166 | 9E-10      |    0.210452 | 4E-10      | 26.92            |
| 5E-05            |     0.120166 | 2E-09      |    0.210452 | 2E-09      | 3.95             |
| 1E-04            |     0.120166 | 1E-08      |    0.210452 | 8E-09      | 2.28             |
| 5E-04            |     0.120166 | 3E-07      |    0.210452 | 2E-07      | 1.03             |
| 1E-03            |     0.120166 | 1E-06      |    0.210453 | 9E-07      | 0.94             |
| 5E-03            |     0.1202   | 3E-05      |    0.21047  | 2E-05      | 0.80             |
| Monte Carlo 25mm |     0.12015  | 9E-06      |    0.21044  | 1E-05      | 182.98           |

Consider the European call and put options where the Strike ğ¾ = 4 . 30 , expiration ğœ = 1 , risk-free rate ğ‘Ÿ = 0 . 05 , volatility ğœ = 0 . 1 and the current price ğ‘† ğ‘¡ = 4 . 00 ; using these parameters the call price ğ¶ ğ‘¡ = 0 . 12016559257970 and the put price ğ‘ƒ ğ‘¡ = 0 . 21045211793277 as calculated using the analytic expressions above.

We compare the analytic and Monte Carlo results to the Moate Simulation results. Using different spacings on the log price grid the distributions of prices at the expiry can be obtained, and the discounted expectation

An alternative approach is to use a simple Monte Carlo Simulation with antithetic sampling using 365 steps and 25 million paths for the same parameters; this provided results for the call and put respectively of 0.12015 and 0.21044 and these differ from the analytic values by about 1E-5. While there are other refinements of Monte Carlo like the use of quasi-random sequences which could be employed to potentially improve the accuracy of the result, 25 million paths might be considered to be a large number of paths in practice.

Table 2: Moate Simulation numerical details for the same options presented in table 1. For the calculation 365 daily iteration steps were used for differing uniform grids in the Log Price space. Probability distributions were retained to a CDF threshold of 1e-12 at both ends of the distribution.

|   Log Grid spacing |   Start min L |   Start max L |   Start grid size |   End grid size |   End min L |   End max L |   End Min S |   End Max S |
|--------------------|---------------|---------------|-------------------|-----------------|-------------|-------------|-------------|-------------|
|             1e-05  |       1.35314 |       1.4197  |              6657 |          122453 |    0.819034 |     2.04355 |        2.27 |        7.72 |
|             5e-05  |       1.35317 |       1.41967 |              1331 |           24491 |    0.819044 |     2.04354 |        2.27 |        7.72 |
|             0.0001 |       1.35322 |       1.41962 |               665 |           12245 |    0.819094 |     2.04349 |        2.27 |        7.72 |
|             0.0005 |       1.35342 |       1.41942 |               133 |            2449 |    0.819294 |     2.04329 |        2.27 |        7.72 |
|             0.001  |       1.35342 |       1.41942 |                67 |            1225 |    0.819294 |     2.04329 |        2.27 |        7.72 |
|             0.005  |       1.35642 |       1.41642 |                13 |             245 |    0.821294 |     2.04129 |        2.27 |        7.7  |

Table 3: Black-Scholes results with the same parameters as used in table 1 that compare analytic price with Moate Simulation prices using 365 daily steps or a single annual step (1), and with the numerically integrate analytic terminal probability density (pdf on grid) for the finer grid spacings. Similar accuracy is obtained for a given spacing across all three integrations calculations.

| Source      | Spacing   |   Call Price | Call Abs diff   |   Put Price | Put Abs diff   |
|-------------|-----------|--------------|-----------------|-------------|----------------|
| analytic    | analytic  |     0.120166 | -               |    0.210452 | -              |
| 365         | 1E-05     |     0.120166 | 9E-10           |    0.210452 | 4E-10          |
| 1           | 1E-05     |     0.120166 | 2E-10           |    0.210452 | 7E-11          |
| pdf on grid | 1E-05     |     0.120166 | 8E-11           |    0.210452 | 8E-11          |
| 365         | 5E-05     |     0.120166 | 2E-09           |    0.210452 | 2E-09          |
| 1           | 5E-05     |     0.120166 | 3E-09           |    0.210452 | 2E-09          |
| pdf on grid | 5E-05     |     0.120166 | 1E-09           |    0.210452 | 1E-09          |
| 365         | 1E-04     |     0.120166 | 1E-08           |    0.210452 | 8E-09          |
| 1           | 1E-04     |     0.120166 | 1E-08           |    0.210452 | 9E-09          |
| pdf on grid | 1E-04     |     0.120166 | 2E-10           |    0.210452 | 2E-10          |

of the payoff profile ğ‘Œ ( ğ‘† ) assuming the time ğ‘‡ terminal distribution ğ‘“ ğ‘‡ ( ğ‘† ) gives the price according to the equation which is equivalently written as

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

For call options ğ‘Œ ( ğ‘† ) = max(0 , ğ‘† ğ‘¡ -ğ¾ ) = ( ğ‘† ğ‘¡ -ğ¾ ) + while for put options ğ‘Œ ( ğ‘† ) = max(0 , ğ¾ -ğ‘† ğ‘¡ ) = ( ğ¾ -ğ‘† ğ‘¡ ) + .

The cumulative probability distribution function is calculated as ğ‘“ ğ‘– = âˆ‘ï¸€ ğ‘– ğ‘— =0 ğ¹ ğ‘— or otherwise estimated from the probability density function ğ¹ . The distribution at expiry is given for ğ¿ ğ‘‡ = log ğ‘† ğ‘‡ on the last step of the simulation. Transforming the variable from log price back to price is simple (exp( ğ¿ ğ‘–,ğ‘‡ ) , ğ‘“ ğ‘–,ğ‘‡ ) = (( ğ‘† ğ‘–,ğ‘‡ ) , ğ‘“ ğ‘–,ğ‘‡ ) and the PDF values on the new are obtained by differentiation of the CDF ğ‘“ ğ‘‡ ( ğ‘‹ ) . A number of different integration approaches 1 were compared but the accuracy of the integration was very similar across all approaches so the results presented here are the simple integration on the log price grid.

Table 2 shows the sizes of the grids that were used at the first step and last step of the simulation. The distributions are bounded by a threshold which is set to be suitably low, in this case where the CDF is bounded

Table 1 compares the analytic values with their corresponding Monte Carlo results, along with the Moate Simulation derived prices using different spacings on the Log price grid. The Monte Carlo results are comparable in accuracy to the coarsest grid (5E-03) results for Moate Simulation, although the Moate Simulation was around 1000 times faster. As might be anticipated, finer the log price grid the more accurate the prices become; this continues are until the relative differences in the price appear to bottom out at around 8 or 9 significant figures of agreement. This represents a large improvement on the Monte Carlo derived value in terms of both accuracy and speed.

1 The integration approaches tested included (i) simple integration on the log price grid, (ii) simple integration on the regular price grid, (iii) cubic spline interpolated function to perform Romberg quadrature, (iv) cubic spline interpolated function to perform Gaussian quadrature, (v) PCHIP interpolated function to perform Romberg quadrature, (vi) PCHIP interpolated function to perform Gaussian quadrature, (vii) Simpson's rule.

at values of 1E-12 and 1.0 - 1E-12. As a result, the grid sizes are roughly proportional to the reciprocal of the grid spacing. As the distribution becomes more diffuse the grid size increases and, at the end of the simulation, the number of grid points is close to 20 times larger than at the beginning.

Analytic results will always be preferred where they exist, and Monte Carlo approaches may have unique advantages (e.g. for options with look back or averaging features), but Moate Simulation holds out the exciting prospect of accurate pricing where the chosen stochastic processes do not have any known analytic solution. This opens a significant new front in the modelling of financial, economic and other scientific domains which are built on top of stochastic processes.

To determine the extent to which the accuracy is affected by the initialisation or number of iterative steps, the numerical results are compared in table 3 where the analytic option prices are compared with a 365 daily step simulation, with a single (1) step simulation, and with the known analytic terminal distribution discretised (PDF) on the grid and integrated with the option payoff profiles in the same manner as the 365 day and 1 year results. The results suggest that the a similar accuracy is achieved with all the numerical approaches (365,1,pdf on grid) and that the differences between these results and the analytic values is small with 8 to 9 significant figure agreement produced. The remaining error is common to all three numerical approaches, and could arise from various causes including the truncation of the grids or the specific integration techniques used.

## 6 Extensions

We demonstrated in the last section that the Moate Simulation approach can produce results of high numerical accuracy. In this section we consider a set of extensions which address derivative pricing features that are of interest to some practitioners in finance.

## 6.1 Altered Payoff Profiles

The payoff profile ğ‘Œ ( ğ‘† ğ‘‡ ) was stated above for vanilla European call and put options as max(0 , ğ‘† ğ‘‡ -ğ¾ ) and max(0 , ğ¾ -ğ‘† ğ‘‡ ) respectively. If an arbitrary payoff profile is sufficiently accurately represented on the selected grid then it is possible to price the derivative. An example of a digital (or binary) payoff profile pays 1 unit at ğ‘‡ if ğ‘† ğ‘‡ &gt; ğ¾ otherwise pays nothing; this payoff is a Heaviside step function ğ» ( Â· ) so that ğ‘Œ ( ğ‘† ğ‘‡ ) = ğ» ( ğ¾ ) = 1 { ğ‘† ğ‘‡ &gt;ğ¾ } . For European power options the call and put payoff functions are max(0 , ğ‘† ğ›¼ ğ‘‡ -ğ¾ ) and max(0 , ğ¾ -ğ‘† ğ›¼ ğ‘‡ ) where the exponent ğ›¼ is greater than zero. The expectation here is that as long as both the payoff function ğ‘Œ ( ğ‘† ) and the distribution at expiry ğ‘“ ( ğ‘† ) are well represented on the grid then numerical integration should produce acceptably accurate derivative valuations.

## 6.2 Dividends

Dividends can be treated in a number of different ways. Firstly, the payment may be modelled to pay out on a discrete dates, or be considered to pay continuously. The former case is the typically observed market behaviour while the latter case is easier to model producing tractable analytic solutions starting with processes like the modification of the Samuelson Process in equation 25 to include a continuous dividend rate (also called dividend yield) ğ· ğ‘¦ as

<!-- formula-not-decoded -->

Secondly, the dividend payment (or yield) is most commonly modelled as a known or predicted discrete value, but an alternative is to model the dividend payment or yield as a distribution.

The four different cases from the permutations from discrete or continuous payment timing with the choice of discrete dividend value versus a distribution of values are all tractable with Moate Simulation. The discrete payment on known dates (the typical market convention) is easily achieved by subtracting the dividend payout ğ‘‘ so that { ( ğ‘† ( ğ‘¡ ) ğ‘– , ğ‘“ ( ğ‘¡ ) ğ‘– ) } pay dividend -- - - - - - - - â†’ { ( ğ‘† ( ğ‘¡ ) ğ‘– -ğ‘‘ ğ‘¡ ) , ğ‘“ ( ğ‘¡ ) ğ‘– ) } on the particular dividend date ğ‘¡ . The case of a known dividend yield paid continuously is easily performed by modifying the drift coefficient ğ‘ by subtraction of the dividend yield ğ· ğ‘¦ as inferred from the example process in equation 41. Where the dividend payment is modelled as a distribution, this can be handled as an additional convolution step on the payment date.

## 6.3 Barriers

Barrier options, which knock-in or knock-out if the price is above (or alternatively below) some barrier ğµ ğ‘¡ on a given date ğ‘¡ are treated in Moate Simulation by restricting the price distribution that is carried over onto the next step of the simulation. For example if the up-and-out style barrier option is designed to allow only the distribution ğ‘“ ( ğ‘† ğ‘¡ ) where ğ‘† ğ‘¡ &lt; ğµ ğ‘¡ to propagate to the next step, then zeroing ğ‘“ ( ğ‘¡ ) ğ‘– for ğ‘† ( ğ‘¡ ) ğ‘– &gt; = ğµ ğ‘¡ will yield a distribution in which some of the distribution has been 'cast away' so that the remaining distribution integrates to the probability of the option being live after the barrier date. If the barrier exists for multiple dates, or even

Table 4: Moate Simulation results for Black-Scholes call and put option Greeks for daily (365 iterations) grid evolution. The vanilla European options have a strike of ğ¾ = 4 . 30 , expiration ğœ = 1 , risk-free rate ğ‘Ÿ = 0 . 05 , volatility ğœ = 0 . 1 and the current spot price ğ‘† ğ‘¡ = 4 . 00 . The precision shown is to the first differing digit from the analytic value, and the absolute difference is the absolute difference to the analytic value. Probability distributions are retained to a CDF threshold of 1e-12.

| Finite Step       | Type           | Log Spacing       |    Price | Abs Diff   | Delta                              | Abs Diff          | Gamma               | Abs Diff          | Rho                           | Abs Diff          |      Theta | Abs Diff   | Vega                    | Abs Diff          |
|-------------------|----------------|-------------------|----------|------------|------------------------------------|-------------------|---------------------|-------------------|-------------------------------|-------------------|------------|------------|-------------------------|-------------------|
| analytic          | call           | -                 | 0.120166 | -          | 0.431244511793                     | -                 | 0.982506747863      | -                 | 1.604812454593                | -                 | -0.158841  | -          | 1.572010796581          | -                 |
| 1E-04 1E-03 1E-02 | call call call | 1E-05 1E-05 1E-05 | 0.120166 | 1E-09      | 0.4312445118 0.43124454 0.431247   | 5E-11 3E-08 3E-06 | 1.01 0.98251 0.9825 | 3E-02 4E-06 5E-05 | 1.60481247 1.604814 1.605     | 2E-08 2E-06 2E-04 | -0.158841  | 6E-08      | 1.5720107 1.57201 1.572 | 5E-08 4E-06 4E-04 |
| 1E-04 1E-03 1E-02 | call call call | 5E-05 5E-05 5E-05 | 0.120166 | 5E-10      | 0.43124451 0.43124454 0.431247     | 1E-09 3E-08 3E-06 | 0 0.98251 0.9825    | 6E-01 4E-06 5E-05 | 1.60481247 1.604814 1.605     | 2E-08 2E-06 2E-04 | -0.158841  | 3E-07      | 1.57202 1.57201 1.572   | 7E-06 4E-06 4E-04 |
| 1E-04 1E-03 1E-02 | call call call | 1E-04 1E-04 1E-04 | 0.120166 | 1E-09      | 0.4312 0.4312445 0.431247          | 8E-05 3E-08 3E-06 | 0.6 0.99 0.98248    | 3E-01 7E-03 2E-05 | 1.60481247 1.604814 1.605     | 2E-08 2E-06 2E-04 | -0.15884   | 3E-06      | 1.5721 1.57201 1.572    | 5E-05 4E-06 4E-04 |
| 1E-04 1E-03 1E-02 | call call call | 5E-04 5E-04 5E-04 | 0.120166 | 1E-07      | 0.4315 0.43124448 0.431247         | 3E-04 3E-08 3E-06 | 0 1 0.9823          | 1E+00 4E-01 1E-04 | 1.605 1.604814 1.605          | 1E-03 2E-06 2E-04 | -0.1589    | 5E-05      | 1.5718 1.5718 1.572     | 1E-04 1E-04 4E-04 |
| 1E-04 1E-03 1E-02 | call call call | 1E-03 1E-03 1E-03 | 0.120166 | 4E-07      | 0.431 0.431 0.431247               | 7E-04 7E-04 3E-06 | 0 0 0.97            | 1E+00 1E+00 1E-02 | 1.601 1.604815 1.605          | 3E-03 3E-06 2E-04 | -0.1587    | 1E-04      | 1.5722 1.5722 1.572     | 3E-04 3E-04 4E-04 |
| 1E-04 1E-03 1E-02 | call call call | 5E-03 5E-03 5E-03 | 0.12018  | 2E-05      | 0.431 0.431 0.43122                | 7E-04 7E-04 1E-05 | 0 0 0               | 1E+00 1E+00 8E-01 | 1.601 1.601 1.605             | 3E-03 3E-03 2E-04 | -0.1587    | 1E-04      | 1.5721 1.5721 1.5717    | 1E-04 1E-04 3E-04 |
| analytic          | put            | -                 | 0.210452 | -          | -0.568755488207                    | -                 | 0.982506747863      | -                 | -2.48547407076                | -                 |  0.0456732 | -          | 1.572010796581          | -                 |
| 1E-04 1E-03 1E-02 | put put put    | 1E-05 1E-05 1E-05 | 0.210452 | 5E-10      | -0.568755488 -0.56875545 -0.568752 | 2E-10 3E-08 3E-06 | 1.01 0.98251 0.9825 | 3E-02 4E-06 5E-05 | -2.48547405 -2.485472 -2.4853 | 1E-08 2E-06 1E-04 |  0.0456732 | 6E-08      | 1.5720108 1.57201 1.572 | 4E-08 4E-06 4E-04 |
| 1E-04 1E-03 1E-02 | put put put    | 5E-05 5E-05 5E-05 | 0.210452 | 1E-09      | -0.568755489 -0.56875545 -0.568752 | 1E-09 3E-08 3E-06 | 0 0.98251 0.9825    | 6E-01 4E-06 5E-05 | -2.48547405 -2.485472 -2.4853 | 2E-08 2E-06 1E-04 |  0.0456734 | 3E-07      | 1.57202 1.57201 1.572   | 7E-06 4E-06 4E-04 |
| 1E-04 1E-03 1E-02 | put put put    | 1E-04 1E-04 1E-04 | 0.210452 | 7E-10      | -0.5688 -0.5687555 -0.568752       | 8E-05 3E-08 3E-06 | 0.6 0.99 0.98248    | 3E-01 7E-03 2E-05 | -2.48547405 -2.485472 -2.4853 | 1E-08 2E-06 1E-04 |  0.04568   | 3E-06      | 1.5721 1.57201 1.572    | 5E-05 4E-06 4E-04 |
| 1E-04 1E-03 1E-02 | put put put    | 5E-04 5E-04 5E-04 | 0.210452 | 1E-07      | -0.5684 -0.56875551 -0.568752      | 3E-04 3E-08 3E-06 | 0 1 0.9823          | 1E+00 4E-01 1E-04 | -2.484 -2.485472 -2.4853      | 1E-03 2E-06 2E-04 |  0.0456    | 5E-05      | 1.5718 1.5718 1.572     | 1E-04 1E-04 4E-04 |
| 1E-04 1E-03 1E-02 | put put put    | 1E-03 1E-03 1E-03 | 0.210453 | 4E-07      | -0.569 -0.569 -0.568752            | 7E-04 7E-04 3E-06 | 0 0 0.97            | 1E+00 1E+00 1E-02 | -2.488 -2.485471 -2.4853      | 3E-03 2E-06 2E-04 |  0.0458    | 1E-04      | 1.5722 1.5722 1.572     | 3E-04 3E-04 4E-04 |
| 1E-04 1E-03 1E-02 | put put put    | 5E-03 5E-03 5E-03 | 0.21046  | 2E-05      | -0.569 -0.569 -0.56877             | 7E-04 7E-04 1E-05 | 0 0 0               | 1E+00 1E+00 8E-01 | -2.488 -2.488 -2.4852         | 3E-03 3E-03 2E-04 |  0.0458    | 1E-04      | 1.5721 1.5721 1.5717    | 1E-04 1E-04 3E-04 |

all of the dates, then the restriction on the distribution is applied on each relevant date. The effect is for the distribution that goes over the barrier to leak away, with the remnant distribution being used for the pricing at option expiry. Multiple barriers are also straightforward.

Where the drift and diffusion coefficients are constants (as mentioned in section 4), or where analytic forms for the distribution are otherwise available, the distribution at the barrier can be obtained in a single step, distribution outside the barrier cast away, and the remaining distribution can be evolved to the next barrier (or expiry) with a single step.

## 6.4 Early Exercise

Options where early exercise is allowed are tractable with Moate Simulation. These include American and Bermudan options; for these options the modelling the decision to exercise early can depend upon the specific features of the option, like whether it pays dividends or not. The intrinsic value ğ¼ of an American put option is given as

<!-- formula-not-decoded -->

If the intrinsic value of the option is greater than the terminal value then the investor should consider the sale of the option. Since the distribution functions ğ‘“ ( ğ‘¡ ) are known for each date ğ‘¡ it is possible to calculate the intrinsic value. A similar approach may be taken for Bermudan options where exercise is allowed on a smaller set of dates.

## 6.5 Computing Greeks

Numerically computing of sensitivities of the option prices to changes in parameters, known informally in finance as the Greeks, is possible with finite differencing techniques. However, special attention is required to avoid unacceptable loss in numerical precision. We have seen in the examples presented in table 1 that the prices can be obtained to relatively high degrees of accuracy. Table 4 shows the degree of accuracy that was achieved on different distribution function grid spacings and for different finite differencing step sizes to yield the derivatives of the price with respect to the different parameters. Where ğ‘‰ ğ‘¡ represents the option price, the table includes

Delta ( ğ‘‘ğ‘‰ ğ‘¡ ğ‘‘ğ‘† ğ‘¡ ), Gamma ( ğ‘‘ 2 ğ‘‰ ğ‘¡ ğ‘‘ğ‘† 2 ğ‘¡ ), Rho ( ğ‘‘ğ‘‰ ğ‘¡ ğ‘‘ğ‘Ÿ ), Theta ( -ğ‘‘ğ‘‰ ğ‘¡ ğ‘‘ğœ ) and Vega ( ğ‘‘ğ‘‰ ğ‘¡ ğ‘‘ğœ ) sensitivities. The trade-off between precision in the price and size of the finite step is evident, particularly for Gamma where differencing occurs twice to obtain the second derivative.

## 6.6 Jump Increments

Although this paper has focused on processes with Wiener increments ğ‘‘ğ‘Š , represented over a period âˆ† ğ‘¡ by âˆ† ğ‘Š , a standard normal distribution ğ’© (0 , âˆ† ğ‘¡ ) , it is also possible to model jumps increments. Merton[13, 14] introduced jumps into price processes in combination with diffusion to form a jump-diffusion process. There are a number of variations of formulation for the jump increment that satisfy different conditions. We have not examined these here but note that the Poisson distributions, key to introducing the jump into the dynamics, can be handled in Moate Simulation using the same convolution techniques as discussed above for the Wiener increments.

## 6.7 Higher Dimensional Models

In section 4 the Moate Simulation was presented for a one dimensional problem, but it is extensible to higher dimensions where the convolution of the probability density function with a diffusion density function is valid if the two diffusion functions are independent. Note that this is not the same as requiring that the marginal densities of either the initial probability density function or the diffusion function are independent; this is not a requirement here.

The convolution of two independent ğ‘˜ dimensional joint probability density functions, ğ¹ and ğº , over a domain ğ· âŠ† R ğ‘˜ is given by a multidimensional integral

<!-- formula-not-decoded -->

where x represents a tuple ( ğ‘¥ 1 , ğ‘¥ 2 , Â· Â· Â· , ğ‘¥ ğ‘˜ ) and x -y represents ( ğ‘¥ 1 -ğ‘¦ 1 , ğ‘¥ 2 -ğ‘¦ 2 , Â· Â· Â· , ğ‘¥ ğ‘˜ -ğ‘¦ ğ‘˜ ). If each of the marginal densities, like ğ¹ ( ğ‘¥ 1 ) , is independent in joint distribution ğ¹ ( x ) then

<!-- formula-not-decoded -->

otherwise the marginal density needs to be determined by integrating the joint distribution over all the other variables, for example by

<!-- formula-not-decoded -->

We also need to extend our notation from earlier so that the application of the drift terms in each dimension to the original distribution ğ¹ ğ‘¡ ( x ) , given by a vector a ( x , ğ‘¡ ) , is represented by the operator âŠ• so that

<!-- formula-not-decoded -->

for the drift-first formulation of the multidimensional Moate Simulation. Figure 3 show a two dimensional example where a drift is performed (ï¸€ ğ¹ ( ğ‘¡ ) ( x ) âŠ• a ( x , ğ‘¡ ) âˆ† ğ‘¡ )ï¸€ and then a diffusion step ( ğº ( x , âˆ† ğ‘¡ ) ) with a bivariate normal distribution that shows non-zero correlation.

## 6.8 Local and Stochastic Volatility Models

In local volatility models the diffusion term is a function of price ğ‘† ğ‘¡ and time ğ‘¡ where the only source of randomness comes from the Wiener increment of the price process. Stochastic volatility models introduce additional sources of risk to model the time evolution of the volatility and this volatility is used in the resulting price (or interest rate, etc.) process. Examples of stochastic volatility models include the SABR Model[15] and the Heston Model[16].

Consider the Heston Model with the form

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

Figure 3: Two dimensional Moate Simulation single step showing drift followed by diffusion with a multivariate normal density function with correlation of ğœŒ = 0 . 75 . The mass of the starting distribution around a single point, represented by the tiny square, is drifted and then diffused. The diffusion is independent of the drifted probability density function ğ¹ ( ğ‘¡ ) ( ğ‘¥ 1 , ğ‘¥ 2 ) and so it is valid to perform the convolution of this starting density with the diffusion density function ğº ( ğ‘¥ 1 , ğ‘¥ 2 , âˆ† ğ‘¡ ) , yielding the resulting density function ğ¹ ( ğ‘¡ +Î” ğ‘¡ ) .

<!-- image -->

If volatility ğœ is set to be the square root of the variance ğœˆ then use of ItË† o's Lemma for each equation gives the system of equations

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

where we have used a Cholesky decomposition of the correlation matrix to transform the ğœŒ correlated Wiener increments ğ‘‘ğ‘Š ğ‘† ğ‘¡ and ğ‘‘ğ‘Š ğœˆ ğ‘¡ into independent Wiener increments ğ‘‘ğ‘Š (1) ğ‘¡ and ğ‘‘ğ‘Š (2) ğ‘¡ .

The log price process depends upon the distribution of the volatility at time ğ‘¡ , and the volatility process is a function of the other parameters alone (but independent of the price). The volatility distribution can be simulated from time zero to any time ğ‘¡ so that the ğœ ğ‘¡ distribution is available for the log price process. Instead of treating ğœ ğ‘¡ as a draw from that distribution, which is denoted here as ğ‘‰ ( ğ‘¡ ) ( ğœ ) , we can consider the log price increment in the discrete time process, âˆ†(log ğ‘† ğ‘¡ ) , as a set of increments on its distribution at time ğ‘¡ each with a different volatility weighted by its probability,

<!-- formula-not-decoded -->

Since the probability density function for volatility is already present on its own grid with associated probability density mass this can be approximated as the sum over the grid points ğ‘– âˆˆ ğ‘› for the volatility probability density function as

<!-- formula-not-decoded -->

The summation, and in the limit the integration too, can be considered as a probability weighted sum over a set of states of the world with different volatility. This numeric approach is tractable and each volatility probability weighed sum of distributions arising from different volatility values and in practical algorithmic terms this is highly parallelisable.

Consider also the SABR Model[15]

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

The forward process ğ¹ ğ‘¡ depends on the stochastic volatility process ğœ ğ‘¡ , with ğ›¼, ğ›½, ğœŒ all being constant parameters within the model. For this demonstration we assume ğœŒ = 0 . The ğœ ğ‘¡ process, equation 55, can be transformed into a log ğœ ğ‘¡ process using ItË† o's Lemma,

<!-- formula-not-decoded -->

Ì¸

A change in variable ğ‘ ( ğ¹ ) = ğ¹ (1 -ğ›½ ) / (1 -ğ›½ ) for ğ›½ = 0 , or ğ‘ ( ğ¹ ) = log( ğ¹ ) for ğ›½ = 0 , gives a process with identical diffusion functional coefficient for any value of ğ‘ so that applying ItË† o's lemma to equation 54 yields

Ì¸

<!-- formula-not-decoded -->

The log volatility could be simulated but it is also available in an analytic form thus we know at ğ‘¡ what the distribution of ğœ ğ‘¡ is exactly. As in the case for the Heston model shown above, where here ğ‘‰ ğ‘¡ ( ğœ ) is the probability distribution derived from the distribution of log ğœ at time ğ‘¡ by change of variable, we obtain a single Moate Simulation step given by

Ì¸

<!-- formula-not-decoded -->

These integrations can be approximated as before where ğœ is represented on a grid with points ğ‘– âˆˆ ğ‘›

Ì¸

<!-- formula-not-decoded -->

which again is summing the probability densities over the ğ‘› states, each representing a state with probability ğ‘‰ ğ‘¡ ( ğœ ğ‘– ) âˆ† ğœ with a different volatility ğœ ğ‘– . With a probability density function known at ğ‘¡ +âˆ† ğ‘¡ the next time set in the simulation can be taken and this is repeated until the desired time horizon.

This section has sketched an approach that uses the Moate Simulation for two stochastic volatility models; this approach can be extended to similar local or stochastic volatility models where there is no recourse to analytic solutions.

## 7 Conclusions

The key insight provided by the Moate Simulation approach introduced here is that convolution techniques can be applied to a distribution function where there are time or spatial dependencies in the drift and diffusion coefficients for stochastic processes. One strength of this approach is that highly accurate numerical results can be obtained. This allows, in the case of finance, the discounting of the evolved terminal spatial distribution to provide an accurate present value of the financial instrument or derivative under consideration. The approach is general and can be applied to processes which describe prices, or other modelled features like rates or volatility. Thus, the approach can provide new ways of eliciting accurate results where closed-form analytic solutions have not been discovered.

Moate Simulation will allow researchers more freedom to select the stochastic models they want to use on the basis of suitability rather than restricting their study to models which may have known closed-form or approximate analytic solutions but which may be limited by their inherent assumptions.

Additionally, the numerical advantages which Moate Simulation provides compared to Monte Carlo techniques vis-a-vis estimation error will be welcomed in many areas of simulation; in finance these include derivative pricing, obtaining estimates of capital requirements to cover counterparty credit risk in institutional portfolios, in financial models for stress testing, Value-at-Risk and Expected Shortfall estimation, or for economic forecasting. In particular the ability of Moate Simulation to represent more accurate tail distributions than Monte Carlo Simulation is notable. Practically, the simulation of stochastic processes can make use of modern hardware like Graphic Processing Units where libraries have been parallelised and optimised for Fourier transformations and convolution.

## References

- [1] Joseph L. Doob. Stochastic Processes . Probability and Statistics Series. Wiley, 1953.
- [2] G.R. Grimmett and D.R. Stirzaker. Probability and Random Processes . Oxford University Press, 2001.
- [3] Steven E. Shreve. Stochastic Calculus for Finance II: Continuous-Time Models . Springer, New York, 2004.
- [4] Fischer Black and Myron S. Scholes. The Pricing of Options and Corporate Liabilities. Journal of Political Economy , 81(3):637-654, May-June 1973.
- [5] Robert C. Merton. Theory of rational option pricing. The Bell Journal of Economics and Management Science , 4(1):141-183, 1973.
- [6] Kiyosi ItË† o. Stochastic integral. Proc. Imperial Acad. Tokyo , 20:519-524, 1944.
- [7] Louis Bachelier. ThÂ´ eorie de la spÂ´ eculation. Annales Scientifiques de l' Â´ Ecole Normale SupÂ´ erieure , 3(17): 21-86, 1900.
- [8] Paul A. Samuelson. Rational theory of warrant pricing. Industrial Management Review , 6(2):13-31, 1965.
- [9] Damiano Brigo and Fabio Mercurio. Interest-Rate Models: Theory and Practice . Springer Finance, 2006.
- [10] Phelim P. Boyle. Options: A Monte Carlo approach. Journal of Financial Economics , 4(3):323-338, 1977.
- [11] Stephen E. Shreve. Stochastic Calculus for Finance I: The Binomial Asset Pricing Model . Springer Finance. Springer New York, 2004.
- [12] Brad G. Osgood. Lectures on the Fourier Transform and Its Applications . Pure and Applied Undergraduate Texts. American Mathematical Society, 2019.
- [13] Robert C. Merton. Option pricing when underlying stock returns are discontinuous. Journal of Financial Economics , 3(1-2):125-144, 1976.
- [14] Robert C. Merton. Continuous-Time Finance . Blackwell Publishers, 1990.
- [15] Patrick Hagan, Deep Kumar, Andrew Lesniewski, and Diana Woodward. Managing Smile Risk. Wilmott Magazine , 1:84-108, 01 2002.
- [16] Steven L. Heston. A Closed-Form Solution for Options with Stochastic Volatility with Applications to Bond and Currency Options. The Review of Financial Studies , 6(2):327-343, 1993.